load_cluster config=complex
----

gen_ranges ranges=20
----

set_span_config delay=10m
[0,9999999999): num_replicas=15 num_voters=6 constraints={'+zone=a4':10,'+region=c':3,'+region=a':11} voter_constraints={'+region=a':3,'+zone=a3':1,'+zone=b1':1}
----

assertion type=conformance under=0 over=0 unavailable=0 violating=0 pretty-format=true validator=true
----

eval duration=60m
----
failed assertion sample 1
  conformance unavailable=0 under=0 over=0 violating=0 
  actual unavailable=0 under=0, over=0 violating=24 lease-violating=0 lease-less-preferred=0
violating constraints:
  r1: [(a:6 voters 6 non_voters) (a2:1 voter) (a3:1 voter) (a4:4 voters 6 non_voters) (c: 3 non_voters) (c1: 1 non_voter) (c3: 2 non_voters)]
  r2: [(a:6 voters 5 non_voters) (a2:1 voter) (a3:1 voter) (a4:4 voters 5 non_voters) (c: 4 non_voters) (c1: 1 non_voter) (c2: 1 non_voter) (c3: 2 non_voters)]
  r2: [(a:6 voters 5 non_voters) (a2:1 voter) (a3:1 voter) (a4:4 voters 5 non_voters) (c: 4 non_voters) (c1: 1 non_voter) (c2: 1 non_voter) (c3: 2 non_voters)]
  r3: [(a:4 voters 8 non_voters) (a1: 1 non_voter) (a3:1 voter) (a4:3 voters 7 non_voters) (c:2 voters 1 non_voter) (c2:1 voter) (c3:1 voter 1 non_voter)]
  r4: [(a:3 voters 9 non_voters) (a2:1 voter) (a3:1 voter) (a4:1 voter 9 non_voters) (c:3 voters) (c1:1 voter) (c2:2 voters)]
  r5: [(a:5 voters 7 non_voters) (a2: 1 non_voter) (a3:1 voter) (a4:4 voters 6 non_voters) (c:1 voter 2 non_voters) (c1:1 voter 1 non_voter) (c2: 1 non_voter)]
... and 18 more
satisfiable:
expected configuration:
	1.zone:
		a3: 1 voter
		a4: 10 non_voters
		b1: 1 voter
	2.region:
		a: 3 voters, 8 non_voters
		b: 1 voter
		c: 3 non_voters
	3.cluster: 6 voters, 9 non_voters
constraint:
replicas=15
voters=6
constraints=[+region=a:11 +region=c:3 +zone=a4:10]
voter_constraints=[+region=a:3 +zone=a3:1 +zone=b1:1]

topology
----
a
  a1
  │ └── [1]
  a2
  │ └── [2 3]
  a3
  │ └── [4 5 6]
  a4
  │ └── [7 8 9 10 11 12 13 14 15 16]
b
  b1
  │ └── [17 18]
c
  c1
    └── [19 20 21]
  c2
    └── [22 23 24]
  c3
    └── [25 26 27 28]
