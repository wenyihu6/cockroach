skip_under_ci
----

gen_cluster nodes=5
----

gen_ranges ranges=500 placement_type=skewed
----

set_capacity store=5 io_threshold=1
----

# Expect s5 to get no replicas due to IO overload.
assertion type=stat stat=replicas stores=(5) exact_bound=0 ticks=5
----

eval duration=10m seed=42 metrics=(replicas,leases) cfgs=(sma-count,mma-only)
----
leases#1: first: [s1=259, s2=129, s3=64, s4=32, s5=16] (stddev=88.43, mean=100.00, sum=500)
leases#1: last:  [s1=180, s2=102, s3=106, s4=106, s5=6] (stddev=55.34, mean=100.00, sum=500)
leases#1: thrash_pct: [s1=23%, s2=23%, s3=20%, s4=27%, s5=0%]  (sum=93%)
replicas#1: first: [s1=500, s2=456, s3=262, s4=165, s5=117] (stddev=153.29, mean=300.00, sum=1500)
replicas#1: last:  [s1=347, s2=343, s3=348, s4=345, s5=117] (stddev=91.52, mean=300.00, sum=1500)
replicas#1: thrash_pct: [s1=47%, s2=44%, s3=46%, s4=48%, s5=0%]  (sum=184%)
artifacts[sma-count]: 937f126429994d65
failed assertion sample 1
  stat=replicas value=(=0.00) ticks=5
	store=5 stat=117.00
	store=5 stat=117.00
	store=5 stat=117.00
	store=5 stat=117.00
	store=5 stat=117.00
	store=5 stat=117.00
==========================
leases#1: first: [s1=259, s2=129, s3=64, s4=32, s5=16] (stddev=88.43, mean=100.00, sum=500)
leases#1: last:  [s1=172, s2=109, s3=108, s4=106, s5=5] (stddev=53.65, mean=100.00, sum=500)
leases#1: thrash_pct: [s1=24%, s2=26%, s3=19%, s4=23%, s5=0%]  (sum=93%)
replicas#1: first: [s1=500, s2=456, s3=262, s4=165, s5=117] (stddev=153.29, mean=300.00, sum=1500)
replicas#1: last:  [s1=343, s2=345, s3=350, s4=345, s5=117] (stddev=91.53, mean=300.00, sum=1500)
replicas#1: thrash_pct: [s1=48%, s2=53%, s3=46%, s4=53%, s5=0%]  (sum=201%)
artifacts[mma-only]: 1757cd64278cd0d7
failed assertion sample 1
  stat=replicas value=(=0.00) ticks=5
	store=5 stat=117.00
	store=5 stat=117.00
	store=5 stat=117.00
	store=5 stat=117.00
	store=5 stat=117.00
	store=5 stat=117.00
==========================
