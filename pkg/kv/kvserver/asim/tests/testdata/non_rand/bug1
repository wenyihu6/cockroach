load_cluster config=complex
----

gen_ranges ranges=20
----

set_span_config delay=10m
[0,9999999999): num_replicas=6 num_voters=3 constraints={'+zone=a3':3}, voter_constraints={'+region=a':3,'+zone=a2':2}
----

assertion type=conformance under=0 over=0 unavailable=0 violating=0 pretty-format=true validator=true
----

eval duration=60m
----
failed assertion sample 1
  conformance unavailable=0 under=0 over=0 violating=0 
  actual unavailable=0 under=0, over=0 violating=20 lease-violating=0 lease-less-preferred=0
violating constraints:
  r2: [(a:3voters 2non_voters) (a2:1voter) (a3:1voter 2non_voters) (a4:1voter) (c: 1non_voter) (c3: 1non_voter)]
  r3: [(a:3voters 1non_voter) (a3:2voters 1non_voter) (a4:1voter) (c: 2non_voters) (c2: 1non_voter) (c3: 1non_voter)]
  r4: [(a:3voters) (a3:2voters) (a4:1voter) (c: 3non_voters) (c1: 1non_voter) (c2: 2non_voters)]
  r4: [(a:3voters) (a3:2voters) (a4:1voter) (c: 3non_voters) (c1: 1non_voter) (c2: 2non_voters)]
  r6: [(a:3voters) (a3:2voters) (a4:1voter) (b: 1non_voter) (b1: 1non_voter) (c: 2non_voters) (c3: 2non_voters)]
  r6: [(a:3voters) (a3:2voters) (a4:1voter) (b: 1non_voter) (b1: 1non_voter) (c: 2non_voters) (c3: 2non_voters)]
... and 14 more
expected constraints: replicas=6 voters=3 constraints=[+zone=a3:3] voter_constraints=[+region=a:3 +zone=a2:2]
satisfiable: expected configuration:
	1.zone:
		a2: 2 voters
		a3: 3 non_voters
	2.region:
		a: 3 voters,2 non_voters
	3.cluster: 3 voters,3 non_voters
diff:
	region a: 
	zone a2: (1 missing voters)
	zone a3: (1 extra voters)(1 missing non_voters)
	zone a4: (1 extra voters)
	region c: (1 extra non_voters)
	zone c3: (1 extra non_voters)
	cluster: 


topology
----
a
  a1
  │ └── [1]
  a2
  │ └── [2 3]
  a3
  │ └── [4 5 6]
  a4
  │ └── [7 8 9 10 11 12 13 14 15 16]
b
  b1
  │ └── [17 18]
c
  c1
    └── [19 20 21]
  c2
    └── [22 23 24]
  c3
    └── [25 26 27 28]

# set_span_config delay=2m
# [0,9999999999): num_replicas=2 num_voters=2 constraints={'+zone=b1':2}
# ----
